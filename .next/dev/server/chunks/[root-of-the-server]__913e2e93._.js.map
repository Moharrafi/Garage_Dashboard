{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nconst requiredEnv = [\"MYSQL_HOST\", \"MYSQL_PORT\", \"MYSQL_USER\", \"MYSQL_PASSWORD\", \"MYSQL_DATABASE\"] as const\n\nfor (const key of requiredEnv) {\n  if (!process.env[key]) {\n    throw new Error(`Missing required environment variable: ${key}`)\n  }\n}\n\nconst pool = mysql.createPool({\n  host: process.env.MYSQL_HOST,\n  port: Number(process.env.MYSQL_PORT),\n  user: process.env.MYSQL_USER,\n  password: process.env.MYSQL_PASSWORD,\n  database: process.env.MYSQL_DATABASE,\n  waitForConnections: true,\n  connectionLimit: Number(process.env.MYSQL_POOL_SIZE ?? 10),\n  timezone: \"+00:00\",\n})\n\nexport async function query<T>(sql: string, params: unknown[] = []) {\n  const [rows] = await pool.query(sql, params)\n  return rows as T\n}\n\nexport async function getConnection() {\n  return pool.getConnection()\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAEA,MAAM,cAAc;IAAC;IAAc;IAAc;IAAc;IAAkB;CAAiB;AAElG,KAAK,MAAM,OAAO,YAAa;IAC7B,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,EAAE;QACrB,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,KAAK;IACjE;AACF;AAEA,MAAM,OAAO,MAAM,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU;IACnC,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,oBAAoB;IACpB,iBAAiB,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;IACvD,UAAU;AACZ;AAEO,eAAe,MAAS,GAAW,EAAE,SAAoB,EAAE;IAChE,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,KAAK,aAAa;AAC3B"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/app/api/transactions/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\"\nimport { getConnection, query } from \"@/lib/db\"\nimport type { Item, StockTransaction } from \"@/lib/types\"\n\nexport async function GET() {\n  const transactions = await query<StockTransaction[]>(\n    \"SELECT * FROM stock_transactions ORDER BY created_at DESC\",\n  )\n  return NextResponse.json(transactions)\n}\n\nexport async function POST(request: NextRequest) {\n  const body = await request.json()\n  const connection = await getConnection()\n\n  try {\n    await connection.beginTransaction()\n    const [items] = await connection.query<Item[]>(\"SELECT * FROM items WHERE id = ?\", [body.item_id])\n\n    if (!Array.isArray(items) || items.length === 0) {\n      await connection.rollback()\n      return NextResponse.json({ message: \"Barang tidak ditemukan\" }, { status: 404 })\n    }\n\n    const item = items[0]\n    const quantity = Number(body.quantity)\n    const type = body.type as \"masuk\" | \"keluar\"\n    const newStock = type === \"masuk\" ? item.stock + quantity : item.stock - quantity\n\n    if (newStock < 0) {\n      await connection.rollback()\n      return NextResponse.json({ message: \"Stok tidak mencukupi\" }, { status: 400 })\n    }\n\n    const txId = crypto.randomUUID()\n\n    await connection.query(\n      `INSERT INTO stock_transactions (\n        id, item_id, item_name, type, quantity, date, note, created_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, NOW())`,\n      [txId, body.item_id, item.name, type, quantity, body.date, body.note],\n    )\n\n    await connection.query(\"UPDATE items SET stock = ?, updated_at = NOW() WHERE id = ?\", [newStock, item.id])\n\n    await connection.commit()\n\n    const [transactionRow] = await query<StockTransaction[]>(\"SELECT * FROM stock_transactions WHERE id = ?\", [txId])\n\n    return NextResponse.json({\n      transaction: transactionRow ?? {\n        id: txId,\n        item_id: item.id,\n        item_name: item.name,\n        type,\n        quantity,\n        date: body.date,\n        note: body.note ?? null,\n        created_at: new Date().toISOString(),\n      },\n      item: { ...item, stock: newStock },\n    })\n  } catch (error) {\n    await connection.rollback()\n    console.error(error)\n    return NextResponse.json({ message: \"Gagal menambahkan transaksi\" }, { status: 500 })\n  } finally {\n    connection.release()\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,eAAe,MAAM,IAAA,oHAAK,EAC9B;IAEF,OAAO,+QAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,OAAoB;IAC7C,MAAM,OAAO,MAAM,QAAQ,IAAI;IAC/B,MAAM,aAAa,MAAM,IAAA,4HAAa;IAEtC,IAAI;QACF,MAAM,WAAW,gBAAgB;QACjC,MAAM,CAAC,MAAM,GAAG,MAAM,WAAW,KAAK,CAAS,oCAAoC;YAAC,KAAK,OAAO;SAAC;QAEjG,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU,MAAM,MAAM,KAAK,GAAG;YAC/C,MAAM,WAAW,QAAQ;YACzB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,OAAO,KAAK,CAAC,EAAE;QACrB,MAAM,WAAW,OAAO,KAAK,QAAQ;QACrC,MAAM,OAAO,KAAK,IAAI;QACtB,MAAM,WAAW,SAAS,UAAU,KAAK,KAAK,GAAG,WAAW,KAAK,KAAK,GAAG;QAEzE,IAAI,WAAW,GAAG;YAChB,MAAM,WAAW,QAAQ;YACzB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,OAAO,OAAO,UAAU;QAE9B,MAAM,WAAW,KAAK,CACpB,CAAC;;2CAEoC,CAAC,EACtC;YAAC;YAAM,KAAK,OAAO;YAAE,KAAK,IAAI;YAAE;YAAM;YAAU,KAAK,IAAI;YAAE,KAAK,IAAI;SAAC;QAGvE,MAAM,WAAW,KAAK,CAAC,+DAA+D;YAAC;YAAU,KAAK,EAAE;SAAC;QAEzG,MAAM,WAAW,MAAM;QAEvB,MAAM,CAAC,eAAe,GAAG,MAAM,IAAA,oHAAK,EAAqB,iDAAiD;YAAC;SAAK;QAEhH,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,aAAa,kBAAkB;gBAC7B,IAAI;gBACJ,SAAS,KAAK,EAAE;gBAChB,WAAW,KAAK,IAAI;gBACpB;gBACA;gBACA,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI,IAAI;gBACnB,YAAY,IAAI,OAAO,WAAW;YACpC;YACA,MAAM;gBAAE,GAAG,IAAI;gBAAE,OAAO;YAAS;QACnC;IACF,EAAE,OAAO,OAAO;QACd,MAAM,WAAW,QAAQ;QACzB,QAAQ,KAAK,CAAC;QACd,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrF,SAAU;QACR,WAAW,OAAO;IACpB;AACF"}}]
}