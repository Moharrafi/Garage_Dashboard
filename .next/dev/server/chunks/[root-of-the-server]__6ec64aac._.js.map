{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nconst requiredEnv = [\"MYSQL_HOST\", \"MYSQL_PORT\", \"MYSQL_USER\", \"MYSQL_PASSWORD\", \"MYSQL_DATABASE\"] as const\n\nfor (const key of requiredEnv) {\n  if (!process.env[key]) {\n    throw new Error(`Missing required environment variable: ${key}`)\n  }\n}\n\nconst pool = mysql.createPool({\n  host: process.env.MYSQL_HOST,\n  port: Number(process.env.MYSQL_PORT),\n  user: process.env.MYSQL_USER,\n  password: process.env.MYSQL_PASSWORD,\n  database: process.env.MYSQL_DATABASE,\n  waitForConnections: true,\n  connectionLimit: Number(process.env.MYSQL_POOL_SIZE ?? 10),\n  timezone: \"+00:00\",\n})\n\nexport async function query<T>(sql: string, params: unknown[] = []) {\n  const [rows] = await pool.query(sql, params)\n  return rows as T\n}\n\nexport async function getConnection() {\n  return pool.getConnection()\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc;IAAC;IAAc;IAAc;IAAc;IAAkB;CAAiB;AAElG,KAAK,MAAM,OAAO,YAAa;IAC7B,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,EAAE;QACrB,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,KAAK;IACjE;AACF;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU;IACnC,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,oBAAoB;IACpB,iBAAiB,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;IACvD,UAAU;AACZ;AAEO,eAAe,MAAS,GAAW,EAAE,SAAoB,EAAE;IAChE,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,KAAK,aAAa;AAC3B"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/lib/auth/password.ts"],"sourcesContent":["\"use server\"\n\nimport crypto from \"crypto\"\n\nexport async function hashPassword(password: string) {\n  const salt = crypto.randomBytes(16).toString(\"hex\")\n  const hash = await new Promise<string>((resolve, reject) => {\n    crypto.scrypt(password, salt, 64, (error, derivedKey) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(derivedKey.toString(\"hex\"))\n      }\n    })\n  })\n  return { hash, salt }\n}\n\nexport async function verifyPassword(password: string, hash: string, salt: string) {\n  const derived = await new Promise<string>((resolve, reject) => {\n    crypto.scrypt(password, salt, 64, (error, derivedKey) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(derivedKey.toString(\"hex\"))\n      }\n    })\n  })\n  return crypto.timingSafeEqual(Buffer.from(hash, \"hex\"), Buffer.from(derived, \"hex\"))\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;AAEO,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,MAAM,IAAI,QAAgB,CAAC,SAAS;QAC/C,gHAAM,CAAC,MAAM,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO;YACxC,IAAI,OAAO;gBACT,OAAO;YACT,OAAO;gBACL,QAAQ,WAAW,QAAQ,CAAC;YAC9B;QACF;IACF;IACA,OAAO;QAAE;QAAM;IAAK;AACtB;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY,EAAE,IAAY;IAC/E,MAAM,UAAU,MAAM,IAAI,QAAgB,CAAC,SAAS;QAClD,gHAAM,CAAC,MAAM,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO;YACxC,IAAI,OAAO;gBACT,OAAO;YACT,OAAO;gBACL,QAAQ,WAAW,QAAQ,CAAC;YAC9B;QACF;IACF;IACA,OAAO,gHAAM,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,MAAM,QAAQ,OAAO,IAAI,CAAC,SAAS;AAC/E;;;IAzBsB;IAcA;;AAdA,iPAAA;AAcA,iPAAA"}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/lib/profile.ts"],"sourcesContent":["import crypto from \"crypto\"\nimport { query } from \"@/lib/db\"\nimport { hashPassword } from \"@/lib/auth/password\"\nimport type { AdminProfile, AdminProfileRecord } from \"@/lib/types\"\n\nconst PROFILE_TABLE = \"admin_profiles\"\n\ntype ProfileRow = {\n  id: string\n  email: string\n  password_hash: string\n  password_salt: string\n  full_name: string\n  phone: string | null\n  address: string | null\n  workshop_name: string | null\n  role: \"admin\" | \"staff\" | \"owner\"\n  avatar_url: string | null\n  join_date: Date | string | null\n  notify_email: 0 | 1\n  notify_push: 0 | 1\n  notify_stock_alert: 0 | 1\n  notify_unit_complete: 0 | 1\n  notify_daily_report: 0 | 1\n  created_at: Date | string\n  updated_at: Date | string\n}\n\ntype ProfileUpdatePayload = Partial<{\n  full_name: string\n  email: string\n  phone: string\n  address: string\n  workshop_name: string\n  avatar_url: string\n  notify_email: boolean\n  notify_push: boolean\n  notify_stock_alert: boolean\n  notify_unit_complete: boolean\n  notify_daily_report: boolean\n}>\n\nexport type { ProfileUpdatePayload }\n\nasync function ensureProfileTable() {\n  await query(`\n    CREATE TABLE IF NOT EXISTS ${PROFILE_TABLE} (\n      id CHAR(36) PRIMARY KEY,\n      email VARCHAR(191) NOT NULL,\n      password_hash VARCHAR(255) NOT NULL,\n      password_salt VARCHAR(255) NOT NULL,\n      full_name VARCHAR(191) NOT NULL,\n      phone VARCHAR(50),\n      address TEXT,\n      workshop_name VARCHAR(191),\n      role ENUM('admin','staff','owner') NOT NULL DEFAULT 'staff',\n      avatar_url TEXT,\n      join_date DATE DEFAULT (CURRENT_DATE),\n      notify_email TINYINT(1) DEFAULT 1,\n      notify_push TINYINT(1) DEFAULT 1,\n      notify_stock_alert TINYINT(1) DEFAULT 1,\n      notify_unit_complete TINYINT(1) DEFAULT 1,\n      notify_daily_report TINYINT(1) DEFAULT 0,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n    )\n  `)\n\n}\n\nfunction mapProfile(row: ProfileRow): AdminProfileRecord {\n  return {\n    id: row.id,\n    email: row.email,\n    full_name: row.full_name,\n    phone: row.phone ?? \"\",\n    address: row.address ?? \"\",\n    workshop_name: row.workshop_name ?? \"\",\n    role: row.role,\n    avatar_url: row.avatar_url ?? \"\",\n    join_date: row.join_date ? new Date(row.join_date).toISOString() : null,\n    notify_email: Boolean(row.notify_email),\n    notify_push: Boolean(row.notify_push),\n    notify_stock_alert: Boolean(row.notify_stock_alert),\n    notify_unit_complete: Boolean(row.notify_unit_complete),\n    notify_daily_report: Boolean(row.notify_daily_report),\n    created_at: row.created_at,\n    updated_at: row.updated_at,\n    password_hash: row.password_hash,\n    password_salt: row.password_salt,\n  }\n}\n\nasync function seedAdminProfile() {\n  const email = process.env.APP_ADMIN_EMAIL ?? \"admin@gtagarage.com\"\n  const password = process.env.APP_ADMIN_PASSWORD ?? \"admin123\"\n  const { hash, salt } = await hashPassword(password)\n  const id = crypto.randomUUID()\n  const defaultName = \"Admin GTA Garage\"\n  const workshopName = \"GTA Garage\"\n\n  await query(\n    `INSERT INTO ${PROFILE_TABLE} (\n      id, email, password_hash, password_salt, full_name, workshop_name, role,\n      notify_email, notify_push, notify_stock_alert, notify_unit_complete, notify_daily_report\n    ) VALUES (?, ?, ?, ?, ?, ?, 'admin', 1, 1, 1, 1, 0)`,\n    [id, email, hash, salt, defaultName, workshopName],\n  )\n}\n\nexport async function getOrCreateAdminProfile(): Promise<AdminProfileRecord> {\n  await ensureProfileTable()\n  const rows = await query<ProfileRow[]>(`SELECT * FROM ${PROFILE_TABLE} ORDER BY created_at ASC LIMIT 1`)\n  if (rows.length > 0) {\n    return mapProfile(rows[0])\n  }\n  await seedAdminProfile()\n  const seeded = await query<ProfileRow[]>(`SELECT * FROM ${PROFILE_TABLE} ORDER BY created_at ASC LIMIT 1`)\n  return mapProfile(seeded[0])\n}\n\nexport function toPublicProfile(profile: AdminProfileRecord): AdminProfile {\n  const { password_hash: _hash, password_salt: _salt, ...rest } = profile\n  return rest\n}\n\nexport async function updateAdminProfileFields(payload: ProfileUpdatePayload) {\n  const profile = await getOrCreateAdminProfile()\n\n  const fieldMap: Record<keyof ProfileUpdatePayload, string> = {\n    full_name: \"full_name\",\n    email: \"email\",\n    phone: \"phone\",\n    address: \"address\",\n    workshop_name: \"workshop_name\",\n    avatar_url: \"avatar_url\",\n    notify_email: \"notify_email\",\n    notify_push: \"notify_push\",\n    notify_stock_alert: \"notify_stock_alert\",\n    notify_unit_complete: \"notify_unit_complete\",\n    notify_daily_report: \"notify_daily_report\",\n  }\n\n  const updates: string[] = []\n  const values: unknown[] = []\n\n  Object.entries(payload).forEach(([key, value]) => {\n    const column = fieldMap[key as keyof ProfileUpdatePayload]\n    if (!column || typeof value === \"undefined\" || value === null) return\n    if (typeof value === \"boolean\") {\n      updates.push(`${column} = ?`)\n      values.push(value ? 1 : 0)\n    } else {\n      updates.push(`${column} = ?`)\n      values.push(value)\n    }\n  })\n\n  if (updates.length === 0) {\n    return profile\n  }\n\n  updates.push(\"updated_at = NOW()\")\n\n  await query(`UPDATE ${PROFILE_TABLE} SET ${updates.join(\", \")} WHERE id = ?`, [...values, profile.id])\n  return getOrCreateAdminProfile()\n}\n\nexport async function saveAdminPassword(hash: string, salt: string) {\n  const profile = await getOrCreateAdminProfile()\n  await query(`UPDATE ${PROFILE_TABLE} SET password_hash = ?, password_salt = ?, updated_at = NOW() WHERE id = ?`, [\n    hash,\n    salt,\n    profile.id,\n  ])\n  return profile.id\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/app/api/profile/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\"\nimport { getOrCreateAdminProfile, toPublicProfile, updateAdminProfileFields } from \"@/lib/profile\"\n\nexport async function GET() {\n  try {\n    const profile = await getOrCreateAdminProfile()\n    return NextResponse.json(toPublicProfile(profile))\n  } catch (error) {\n    console.error(\"Failed to load profile:\", error)\n    return NextResponse.json({ message: \"Gagal memuat profil\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const payload = await request.json()\n    if (!payload || typeof payload !== \"object\") {\n      return NextResponse.json({ message: \"Data tidak valid\" }, { status: 400 })\n    }\n    const updated = await updateAdminProfileFields(payload)\n    return NextResponse.json(toPublicProfile(updated))\n  } catch (error) {\n    console.error(\"Failed to update profile:\", error)\n    return NextResponse.json({ message: \"Gagal memperbarui profil\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2IAAuB;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC,IAAA,mIAAe,EAAC;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,IAAI;QAClC,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;YAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QACA,MAAM,UAAU,MAAM,IAAA,4IAAwB,EAAC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC,IAAA,mIAAe,EAAC;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAClF;AACF"}}]
}