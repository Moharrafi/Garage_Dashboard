{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/lib/auth/session.ts"],"sourcesContent":["import crypto from \"crypto\"\n\nconst HEAD = Buffer.from(JSON.stringify({ alg: \"HS256\", typ: \"JWT\" })).toString(\"base64url\")\n\nfunction getSecret() {\n  const secret = process.env.APP_SESSION_SECRET\n  if (!secret) {\n    throw new Error(\"APP_SESSION_SECRET is required\")\n  }\n  return secret\n}\n\nfunction createSignature(data: string, secret: string) {\n  return crypto.createHmac(\"sha256\", secret).update(data).digest(\"base64url\")\n}\n\nexport async function createSessionToken(email: string) {\n  const secret = getSecret()\n  const issuedAt = Math.floor(Date.now() / 1000)\n  const expiresAt = issuedAt + 60 * 60 * 24 * 7 // 7 days\n  const payload = Buffer.from(JSON.stringify({ email, iat: issuedAt, exp: expiresAt })).toString(\"base64url\")\n  const signature = createSignature(`${HEAD}.${payload}`, secret)\n  return `${HEAD}.${payload}.${signature}`\n}\n\nexport async function verifySessionToken(token: string) {\n  try {\n    const secret = getSecret()\n    const [head, payload, signature] = token.split(\".\")\n    if (!head || !payload || !signature) return null\n    const expectedSignature = createSignature(`${head}.${payload}`, secret)\n    if (!crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expectedSignature))) {\n      return null\n    }\n    const data = JSON.parse(Buffer.from(payload, \"base64url\").toString(\"utf-8\"))\n    if (typeof data.exp !== \"number\" || data.exp * 1000 < Date.now()) {\n      return null\n    }\n    return data\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC;IAAE,KAAK;IAAS,KAAK;AAAM,IAAI,QAAQ,CAAC;AAEhF,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IAC7C,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEA,SAAS,gBAAgB,IAAY,EAAE,MAAc;IACnD,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,QAAQ,MAAM,CAAC,MAAM,MAAM,CAAC;AACjE;AAEO,eAAe,mBAAmB,KAAa;IACpD,MAAM,SAAS;IACf,MAAM,WAAW,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IACzC,MAAM,YAAY,WAAW,KAAK,KAAK,KAAK,EAAE,SAAS;;IACvD,MAAM,UAAU,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC;QAAE;QAAO,KAAK;QAAU,KAAK;IAAU,IAAI,QAAQ,CAAC;IAC/F,MAAM,YAAY,gBAAgB,GAAG,KAAK,CAAC,EAAE,SAAS,EAAE;IACxD,OAAO,GAAG,KAAK,CAAC,EAAE,QAAQ,CAAC,EAAE,WAAW;AAC1C;AAEO,eAAe,mBAAmB,KAAa;IACpD,IAAI;QACF,MAAM,SAAS;QACf,MAAM,CAAC,MAAM,SAAS,UAAU,GAAG,MAAM,KAAK,CAAC;QAC/C,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,OAAO;QAC5C,MAAM,oBAAoB,gBAAgB,GAAG,KAAK,CAAC,EAAE,SAAS,EAAE;QAChE,IAAI,CAAC,gHAAM,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,qBAAqB;YACnF,OAAO;QACT;QACA,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,SAAS,aAAa,QAAQ,CAAC;QACnE,IAAI,OAAO,KAAK,GAAG,KAAK,YAAY,KAAK,GAAG,GAAG,OAAO,KAAK,GAAG,IAAI;YAChE,OAAO;QACT;QACA,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/xampp/htdocs/gtavapor/proxy.ts"],"sourcesContent":["import { verifySessionToken } from \"@/lib/auth/session\"\nimport { NextResponse, type NextRequest } from \"next/server\"\n\nconst publicPaths = [\n  \"/auth/login\",\n  \"/auth/sign-up\",\n  \"/api/auth/login\",\n  \"/api/auth/logout\",\n  \"/api/health\",\n  \"/favicon.ico\",\n]\n\nexport default async function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl\n  const isPublic = publicPaths.some((path) => pathname.startsWith(path))\n  const token = request.cookies.get(\"session-token\")?.value\n  const session = token ? await verifySessionToken(token) : null\n\n  if (!session && !isPublic && !pathname.startsWith(\"/_next\")) {\n    const url = request.nextUrl.clone()\n    url.pathname = \"/auth/login\"\n    url.searchParams.set(\"redirectedFrom\", pathname)\n    return NextResponse.redirect(url)\n  }\n\n  if (session && pathname.startsWith(\"/auth\")) {\n    const url = request.nextUrl.clone()\n    url.pathname = \"/\"\n    return NextResponse.redirect(url)\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\"],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,cAAc;IAClB;IACA;IACA;IACA;IACA;IACA;CACD;AAEc,eAAe,MAAM,OAAoB;IACtD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,WAAW,YAAY,IAAI,CAAC,CAAC,OAAS,SAAS,UAAU,CAAC;IAChE,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;IACpD,MAAM,UAAU,QAAQ,MAAM,IAAA,4IAAkB,EAAC,SAAS;IAE1D,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAAS,UAAU,CAAC,WAAW;QAC3D,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,IAAI,YAAY,CAAC,GAAG,CAAC,kBAAkB;QACvC,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,WAAW,SAAS,UAAU,CAAC,UAAU;QAC3C,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAoF;AAChG"}}]
}